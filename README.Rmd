---
output:
  github_document
---


<!-- README.md is generated from README.Rmd. Please edit that file -->

# `registr`

[![](https://travis-ci.org/julia-wrobel/registr.svg?branch=master)](https://travis-ci.org/julia-wrobel/registr)


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
											warning = FALSE,
											message = FALSE,
											collapse = TRUE)

```

Registration for exponential family functional data. 

* Authors: [Julia Wrobel](juliawrobel.com) and [Jeff Goldsmith](jeffgoldsmith.com)
* License: [MIT](https://opensource.org/licenses/MIT). See the [LICENSE](LICENSE) file for details
* Version: 0.1

### What it does

---------------

`registr` is intended to register exponential family functional data

Explain in detail what a binary curve is. Talk about accelerometer data application.

### Installation

---------------

To install the latest version directly from Github, please use:

```{r, eval = FALSE, echo = TRUE}
install.packages("devtools")
devtools::install_github("julia-wrobel/registr", build_vignettes = TRUE)
```


### How to use it

---------------

This example highlights how to use the package for registering simulated binary data. More details on use of the package can be found in the package [vignette](inst/doc/registr.html).

The code below uses a function from our package to simulate curves for 100 subjects with 200 timepoints each, observed over domain $(0, 1)$. All curves have similar structure but the location of the peak is shifted. On the observed domain $t^*$ the curves are unregistered (misaligned). On the domain $t$ the curves are registered (aligned). 



```{r simulate_data, echo = TRUE}
library(registr)

registration_data = simulate_unregistered_curves(I = 100, D = 200, seed = 2018)
```

The plot below shows the unregistered curves and registered curves.

```{r plot_sim_data, fig.align='center', fig.height=3, fig.width=9}
library(tidyverse)
library(gridExtra)

unreg = ggplot(registration_data, aes(x = index, y = boot::inv.logit(latent_mean),
																			group = id)) +
	geom_path(alpha = .25) + theme_bw() + 
	labs(x = "t_star", y = "Prob(Y = 1)")


reg = ggplot(registration_data, aes(x = t, y = boot::inv.logit(latent_mean), 
																		group = id)) +
	geom_path(alpha = .25) + theme_bw() + 
	labs(x = "t", y = "Prob(Y = 1)")

grid.arrange(unreg, reg, ncol = 2)

```


Continuously observed curves are shown above in order to illustrate the misalignment problem and our simulated data; the simulated dataset also includes binary values which have been generated by using these continuous curves as probabilities. The unregistered and registered binary curves for two subjects are shown below.

```{r plot_2subjs, fig.align='center', fig.height=3, fig.width=9}
IDs = c(63, 85)
sub_data = registration_data %>% filter(id %in% IDs)

unreg = ggplot(sub_data, aes(x = index, y = boot::inv.logit(latent_mean),
														 group = id, color = factor(id))) +
	geom_path() + theme_bw() + theme(legend.position = "none") + 
	geom_point(aes(y = value), alpha = 0.25, size = 0.25) +
	labs(x = "t_star", y = "Prob(Y = 1)")


reg = ggplot(sub_data, aes(x = t, y = boot::inv.logit(latent_mean), 
													 group = id, color = factor(id))) +
	geom_path() + theme_bw() + theme(legend.position = "none") +  
	geom_point(aes(y = value), alpha = 0.25, size = 0.25) +
	labs(x = "t", y = "Prob(Y = 1)")

grid.arrange(unreg, reg, ncol = 2)
```

Our software registers curves by estimating $t$. For this we use the function `registration_fpca()`.

```{r register_data, echo = TRUE, message = TRUE}
binary_registration = register_fpca(Y = registration_data, family = "binomial", 
																Kt = 6, Kh = 3, npc  = 1)
```

The plot below shows unregistered, true registered, and estimated registered binary curves two subjects after fitting our method.

```{r plot_fit, fig.align='center', fig.height=3, fig.width=9}
sub_data = binary_registration$Y %>% filter(id %in% IDs)

unreg = ggplot(sub_data, aes(x = tstar, y = boot::inv.logit(latent_mean),
														 group = id, color = factor(id))) +
	geom_path() + theme_bw() + theme(legend.position = "none") + 
	geom_point(aes(y = value), alpha = 0.25, size = 0.25) +
	labs(x = "t_star", y = "Prob(Y = 1)")


reg = ggplot(sub_data, aes(x = t, y = boot::inv.logit(latent_mean), 
													 group = id, color = factor(id))) +
	geom_path() + theme_bw() + theme(legend.position = "none") +  
	geom_point(aes(y = value), alpha = 0.25, size = 0.25) +
	labs(x = "t", y = "Prob(Y = 1)")

reg_hat = ggplot(sub_data, aes(x = t_hat, y = boot::inv.logit(latent_mean), 
													 group = id, color = factor(id))) +
	geom_path() + theme_bw() + theme(legend.position = "none") +  
	geom_point(aes(y = value), alpha = 0.25, size = 0.25) +
	labs(x = "t", y = "Prob(Y = 1)")

grid.arrange(unreg, reg, reg_hat, ncol = 3)

```





